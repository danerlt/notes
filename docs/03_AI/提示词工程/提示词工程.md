# 提示词工程（Prompt engineering)

本文记录了大语言模型（有时称为 GPT 模型）中获得更好结果的策略。

这里有OpenAI的一些样例：https://platform.openai.com/examples

下面列举了6种获取更好结果的策略。下文所有样例都是使用的GPT3.5测试的。

## 一、清晰的指令

模型无法读懂你的想法。如果模型输出太长，请要求简短回复。如果输出太简单，请要求专家级写作。如果您不喜欢这种格式，请演示您希望看到的格式。模型对你想要什么的猜测越少，你得到它的可能性就越大。简单来说需要将你指令说清楚，不要给一个模糊不清的需求。

### 策略1：在查询中包含详细信息以获取更相关的答案

为了获得高度相关的响应，请确保请求提供任何重要的详细信息或上下文。否则，你就要让模型来猜测你的意思了。

#### 示例1：

差的提示词：

```text
如何在 Excel 中添加数字
```

![image-20240516024148757](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516024148757.png)

好的提示词：

```text+
如何在Excel中将一行美元金额相加？我想对一整行自动执行此操作，将结果保存在所有数据的最右侧，列名为“总计”的列。
```

![image-20240516024205549](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516024205549.png)

#### 示例2:

差的提示词：

```
谁是总统？
```

![image-20240516025449383](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516025449383.png)

好的提示词：

```
谁是 2021 年墨西哥总统，选举多久举行一次？
```

![image-20240516025514186](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516025514186.png)

#### 示例3

差的提示词：

```
编写代码来计算斐波那契数列
```

![image-20240516025625406](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516025625406.png)

好的提示词：

```
编写一个 Python 函数来有效地计算斐波那契数列。对代码进行大量注释，以解释每段代码的作用以及为什么这样编写。
```

![image-20240516025855578](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516025855578.png)

![image-20240516025914905](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516025914905.png)

#### 示例4

差的提示词：

```
总结会议记录
```

![image-20240516031415816](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516031415816.png)

好的提示词

```
在单个段落中总结会议记录。然后用markdown列表记录下每一个演讲者和他们的每个关键点。最后，列出演讲者建议的后续步骤或行动项目（如果有）。
```

![image-20240516031703590](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516031703590.png)



### 策略2：要求模型使用角色

system message 可用于指定模型在其回复中使用的角色。

````
SYSTEM: 当我请求帮助写一些东西时，你会回复一份文档，每个段落中至少包含一个笑话或俏皮的评论。
USER: 给我的钢螺栓供应商写一封感谢信，感谢他们在短时间内按时交货。这使我们能够交付一个重要的订单。
````



![image-20240516034427410](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516034427410.png)

![image-20240516034454191](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516034454191.png)

### 策略3：使用分隔符清楚的指示输入的不同部分

三引号、XML 标记、章节标题等分隔符可以帮助划分要区别对待的文本部分。

示例1：

```
使用三行诗句概述下面三引号中的内容。

"""
　豫章故郡，洪都新府。星分翼轸，地接衡庐。襟三江而带五湖，控蛮荆而引瓯越。物华天宝，龙光射牛斗之墟；人杰地灵，徐孺下陈蕃之榻。雄州雾列，俊采星驰。台隍枕夷夏之交，宾主尽东南之美。都督阎公之雅望，棨戟遥临；宇文新州之懿范，襜帷暂驻。十旬休假，胜友如云；千里逢迎，高朋满座。腾蛟起凤，孟学士之词宗；紫电青霜，王将军之武库。家君作宰，路出名区；童子何知，躬逢胜饯。
"""
```

![image-20240516061716698](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516061716698.png)



示例2：

```
你将获得两篇关于同一主题的文章（用 XML 标记分隔）。首先总结每篇文章的论点。然后指出他们中哪一个提出了更好的论点并解释原因。

<article>
珍惜时光

时间，如同流水般匆匆而过，转瞬间我们就发现自己站在了岁月的岸边，回首往事，不禁感叹光阴易逝，生命如白驹过隙，转眼间就逝去了大半。

珍惜时间，就是珍惜生命。每一刻的流逝都是不可挽回的，我们应该学会珍惜眼前的时光，把握当下的每一个机会，活出精彩的人生。正如莎士比亚所说：“昨天已成为历史，明天尚待把握，唯有今天是我们可以把握的时光。”

珍惜时间，就是珍惜与亲人的相处。生活中，我们常常因为忙碌而忽略了身边最亲近的人，等到想要抓紧时间陪伴时，却发现时光已经溜走，留下了无尽的遗憾。因此，我们应该及时抽出宝贵的时间，陪伴家人，与他们分享快乐，共度时光。

珍惜时间，就是珍惜学习的机会。人生短暂，知识却是无穷无尽的。在有限的时间里，我们应该努力学习，不断提升自己，开拓思维，丰富内涵。唯有不断学习，才能与时俱进，不被时代所淘汰。

珍惜时间，就是珍惜生命中的每一个美好瞬间。无论是阳光明媚的早晨，还是星光璀璨的夜晚，都是生命中值得珍惜的时刻。让我们把握每一个机会，享受生活带来的美好，让每一天都充满阳光和希望。

珍惜时间，因为它是生命的精华，是我们实现梦想、追求幸福的基石。让我们从现在开始，珍惜每一分每一秒，活出精彩的人生。
 </article>
 
 <article>
珍惜时光
乌飞免走的时光里，我们要握紧自己的青春。

当你还在为一件小事伤心不已时，那么请抬头看看墙上的挂历它已悄无声息地又被翻过一页。

当你还在感叹世间的种.种不公平时，那么请抬头看看日历，它已悄无声息地又带走了一天;

当你还在喧闹的大街徘徊，那么请看看日历，它已悄无声息地偷走了时光。

所以，年轻的我们，何不踏着时间的脚印，握紧自己的青春。

当无数人还在为何去何从而忧愁不已时，鲁迅早已握紧手中的笔刺向敌人的心脏。他挤出一切时间去创作，写出了“寄意寒星荃不察我以我存轩辕”的豪情壮语。他用一篇篇文章鞭挞了封建社会惨无人道的暴行，揭露了侵略者的丑恶嘴脸，赞扬了敢于直面惨淡人生的拼搏者。他成了伟大的思想家、革命家、文学家。他的创作，他的不朽著作不正是他利用别人喝咖啡的时间写出来的吗?所以，当时间老人手握钢鞭驱赶日历向前翻转时，我们一定要充分利用自己的宝贵时间，不要让自己留下遗憾。

当客人聚集在客厅欢乐，当客人聚集在餐桌旁进餐，牛顿却一人埋头专心致志地做实验。他利用一切时间去做实验，才有了牛顿运动定律等伟大成就。他珍惜一切时间甚至于忘记了自己，他全身心投入到科学研究。所以，当太阳神驾着马车，拉着太阳在天空飞速行驶时，我们该明白一个真理，时光不会逆流。那么，我们就该握紧每一分种，甚至每一秒钟，去做有意义的事。

走在历史的长廊中，随处可见告诫人们要珍惜时光的名句。《长歌》中的“少壮不努力，老大徒伤悲”，岳飞的“莫等闲，白了少年头，空悲切”，无一不在警醒人们珍惜时光。当我们眼睁睁看着墙上的日历一页一页飞速翻动，我们突然间意识到，时光一去不复返。白驹过隙，时光从指缝中悄悄流走。一事无成的我们紧锁眉头，毫无遗憾的我们面露微笑。

是的，杨柳枯了，有再青的时候;桃花谢了，有再开的时候;燕子飞了，有再回的时候;可时光走了，就再也无法挽回。

所以，年轻的我们握紧自己的美好青春，踏上漫漫人生路。
 </article>
```

![image-20240516085820527](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516085820527.png)

补充说明：第一篇文章是GPT生成的，第二篇文章是Google搜索“珍惜时光”搜索到的。

示例3：

```
你将获得论文摘要和建议的标题。论文标题应该让读者对论文的主题有一个很好的了解，但也应该引人注目。如果标题不符合这些标准，请建议 5 个备选方案。

摘要：Large pre-trained language models have been shown to store factual knowledge
in their parameters, and achieve state-of-the-art results when fine-tuned on downstream NLP tasks. However, their ability to access and precisely manipulate knowledge is still limited, and hence on knowledge-intensive tasks, their performance
lags behind task-specific architectures. Additionally, providing provenance for their
decisions and updating their world knowledge remain open research problems. Pretrained models with a differentiable access mechanism to explicit non-parametric
memory have so far been only investigated for extractive downstream tasks. We
explore a general-purpose fine-tuning recipe for retrieval-augmented generation
(RAG) — models which combine pre-trained parametric and non-parametric memory for language generation. We introduce RAG models where the parametric
memory is a pre-trained seq2seq model and the non-parametric memory is a dense
vector index of Wikipedia, accessed with a pre-trained neural retriever. We compare two RAG formulations, one which conditions on the same retrieved passages
across the whole generated sequence, and another which can use different passages
per token. We fine-tune and evaluate our models on a wide range of knowledgeintensive NLP tasks and set the state of the art on three open domain QA tasks,
outperforming parametric seq2seq models and task-specific retrieve-and-extract
architectures. For language generation tasks, we find that RAG models generate
more specific, diverse and factual language than a state-of-the-art parametric-only
seq2seq baseline.

标题：Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks
```

![image-20240516090208001](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516090208001.png)

补充说明：论文标题和摘要参考自[Retrieval-Augmented Generation for Knowledge-Intensive NLP Tasks](https://arxiv.org/abs/2005.11401)

对于此类简单明了的任务，使用分隔符可能不会对输出质量产生影响。但是，任务越复杂，消除任务细节的歧义就越重要。

### 策略4： 指定完成任务所需的步骤

某些任务最好指定为一系列步骤。显式写出步骤可以使模型更容易遵循它们。

示例1：

```
使用以下分步说明来响应用户输入。

第 1 步 - 用户将为您提供三引号的文本。用一句话总结这段文字，前缀是“摘要：”。

第 2 步 - 将第 1 步中的摘要翻译成英语，前缀为“翻译：”

"""
《浮生六记》·卷一 闺房记乐（1）
卷一闺房记乐

余生乾隆癸未冬十一月二十有二日，正值太平盛世，且在衣冠之家，居苏州沧浪亭畔，天之厚我可谓至矣。东坡云：“事如春梦了无痕”，苟不记之笔墨，未免有辜彼苍之厚。

因思《关鸠》冠三百篇之首，故列夫妇于首卷；余以次递及焉。所愧少年失学，稍识之无，不过记其实情实事而已。若必考订其文法，是责明于垢鉴矣。

余幼聘金沙于氏，八龄而夭；娶陈氏。陈名芸，字淑珍，舅氏心余先生女也。生而颖慧，学语时，口授《琵琶行》，即能成诵。四龄失怙；母金氏，弟克昌，家徒壁立。芸既长，娴女红，三口仰其十指供给；克昌从师修脯无缺。一日，于书簏中得《琵琶行》，挨字而认，始识字。刺绣之暇，渐通吟咏，有“秋侵人影瘦，霜染菊花肥”之句。

余年十三，随母归宁，两小无嫌，得见所作，虽叹其才思隽秀，窃恐其福泽不深；然心注不能释，告母曰：“若为儿择妇，非淑姊不娶。”母亦爱其柔和，即脱金约指缔姻焉。此乾隆乙末七月十六日也。

是年冬，值其堂姊出阁，余又随母往。

芸与余同齿而长余十月，自幼姊弟相呼，故仍呼之曰淑姊。

时但见满室鲜衣，芸独通体素淡，仅新其鞋而已。见其绣制精巧，询为己作，始知其慧心不仅在笔墨也。

其形削肩长项，瘦不露骨，眉弯目秀，顾盼神飞，唯两齿微露，似非佳相。一种缠绵之态，令人之意也消。

索观诗稿，有仅一联，或三四句，多未成篇者。询其故，笑曰：“无师之作，愿得知己堪师者敲成之耳。”余戏题其签曰“锦囊佳句”，不知夭寿之机此已伏矣。

是夜送亲城外，返，已漏三下。腹饥索饵，婢妪以枣脯进，余嫌其甜。芸暗牵余袖，随至其室，见藏有暖粥并小菜焉。余欣然举箸，忽闻芸堂兄玉衡呼曰：“淑妹速来！”芸急闭门曰：“已疲乏，将卧矣。”玉衡挤身而入，见余将吃粥，乃笑睨芸曰：“顷我索粥，汝曰‘尽矣’，乃藏此专待汝婿耶？”芸大窘避去，上下哗笑之。余亦负气，挈老仆先归。

自吃粥被嘲，再往，芸即避匿，余知其恐贻人笑也。

至乾隆庚子正月二十二日花烛之夕，见瘦怯身材依然如昔，头巾已揭，相视嫣然。合卺后，并肩夜膳，余暗于案下握其腕，暖尖滑腻，胸中不觉怦怦作跳。让之食，适逢斋期，已数年矣。暗计吃斋之初，正余出痘之期，因笑谓曰：“今我光鲜无恙，姊可从此开戒否？”芸笑之以目，点之以首。

廿四日为余姊于归，廿三国忌不能作乐，故廿二夜即为余姊款嫁，芸出堂陪宴。余在洞房与伴娘对酌，拇战辄北，大醉而卧；醒则芸正晓妆未竟也。

是日亲朋络绎，上灯后始作乐。廿四子正，余作新舅送嫁，丑末归来，业已灯残人静；悄然入室，伴妪盹于床下，芸卸妆尚未卧，高烧银烛，低垂粉颈，不知观何书而出神若此。因抚其肩曰：“姊连日辛苦，何犹孜孜不倦耶？”

芸忙回首起立曰：“顷正欲卧，开橱得此书，不觉阅之忘倦。《西厢》之名闻之熟矣，今始得见，真不愧才子之名，但未免形容尖薄耳。”

余笑曰：“唯其才子，笔墨方能尖薄。”伴妪在旁促卧，令其闭门先去。遂与比肩调笑，恍同密友重逢。戏探其怀，亦怦怦作跳，因俯其耳曰：“姊何心舂乃尔耶？”芸回眸微笑，便觉一缕情丝摇人魂魄；拥之入帐，不知东方之既白。

"""
```

![image-20240516091547584](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516091547584.png)

### 策略5 ： 举例说明

提供适用于所有示例的一般性指令通常比通过示例展示任务的所有排列更高效，但在某些情况下，提供示例可能更容易。例如，如果你希望模型复制一种难以明确描述的特定风格来响应用户查询。这被称为 “few-shot” prompting。

示例1：

```
这太棒了！// Negative
这太糟糕了！// Positive
哇，那部电影太棒了！// Positive
多么可怕的节目！//
```

![image-20240516094435187](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516094435187.png)

### 策略6: 指定输出的长度

您可以要求模型生成给定目标长度的输出。目标输出长度可以根据单词、句子、段落、项目符号等的数量来指定。但请注意，指示模型生成特定数量的单词并不能高精度地工作。该模型可以更可靠地生成具有特定段落或项目符号的输出。

示例1：

```
用大约 50 个字总结用三引号分隔的文本。
"""
　我家的后面有一个很大的园，相传叫作百草园。现在是早已并屋子一起卖给朱 文公的子孙了，连那最末次的相见也已经隔了七八年，其中似乎确凿只有一些野草 ；但那时却是我的乐园。
　　不必说碧绿的菜畦，光滑的石井栏，高大的皂荚树，紫红的桑椹；也不必说鸣 蝉在树叶里长吟，肥胖的黄蜂伏在菜花上，轻捷的叫天子（云雀）忽然从草间直窜 向云霄里去了。单是周围的短短的泥墙根一带，就有无限趣味。油蛉在这里低唱， 蟋蟀们在这里弹琴。翻开断砖来，有时会遇见蜈蚣；还有斑蝥，倘若用手指按住它 的脊梁，便会拍的一声，从后窍喷出一阵烟雾。何首乌藤和木莲藤缠络着，木莲有 莲房一般的果实，何首乌有拥肿的根。有人说，何首乌根是有象人形的，吃了便可 以成仙，我于是常常拔它起来，牵连不断地拔起来，也曾因此弄坏了泥墙，却从来 没有见过有一块根象人样。如果不怕刺，还可以摘到覆盆子，象小珊瑚珠攒成的小 球，又酸又甜，色味都比桑椹要好得远。 　
　　长的草里是不去的，因为相传这园里有一条很大的赤练蛇。
"""
```

![image-20240516094757867](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516094757867.png)

示例2：

```
将用三引号分隔的文本总结成2个段落。

"""
　我家的后面有一个很大的园，相传叫作百草园。现在是早已并屋子一起卖给朱 文公的子孙了，连那最末次的相见也已经隔了七八年，其中似乎确凿只有一些野草 ；但那时却是我的乐园。
　　不必说碧绿的菜畦，光滑的石井栏，高大的皂荚树，紫红的桑椹；也不必说鸣 蝉在树叶里长吟，肥胖的黄蜂伏在菜花上，轻捷的叫天子（云雀）忽然从草间直窜 向云霄里去了。单是周围的短短的泥墙根一带，就有无限趣味。油蛉在这里低唱， 蟋蟀们在这里弹琴。翻开断砖来，有时会遇见蜈蚣；还有斑蝥，倘若用手指按住它 的脊梁，便会拍的一声，从后窍喷出一阵烟雾。何首乌藤和木莲藤缠络着，木莲有 莲房一般的果实，何首乌有拥肿的根。有人说，何首乌根是有象人形的，吃了便可 以成仙，我于是常常拔它起来，牵连不断地拔起来，也曾因此弄坏了泥墙，却从来 没有见过有一块根象人样。如果不怕刺，还可以摘到覆盆子，象小珊瑚珠攒成的小 球，又酸又甜，色味都比桑椹要好得远。 　
　　长的草里是不去的，因为相传这园里有一条很大的赤练蛇。
"""

```

![image-20240516094955286](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516094955286.png)

## 二、提供参考内容

### 策略1：指示模型使用参考内容回答问题

如果我们可以为模型提供与当前查询相关的可信信息，那么我们可以指示模型使用提供的信息来编写其答案。

示例1：

```
SYSTEM: 使用提供的以三引号分隔的文章来回答问题。如果在文章中找不到答案，请回答“我找不到答案”。
USER: 
"""
　我家的后面有一个很大的园，相传叫作百草园。现在是早已并屋子一起卖给朱 文公的子孙了，连那最末次的相见也已经隔了七八年，其中似乎确凿只有一些野草 ；但那时却是我的乐园。
　　不必说碧绿的菜畦，光滑的石井栏，高大的皂荚树，紫红的桑椹；也不必说鸣 蝉在树叶里长吟，肥胖的黄蜂伏在菜花上，轻捷的叫天子（云雀）忽然从草间直窜 向云霄里去了。单是周围的短短的泥墙根一带，就有无限趣味。油蛉在这里低唱， 蟋蟀们在这里弹琴。翻开断砖来，有时会遇见蜈蚣；还有斑蝥，倘若用手指按住它 的脊梁，便会拍的一声，从后窍喷出一阵烟雾。何首乌藤和木莲藤缠络着，木莲有 莲房一般的果实，何首乌有拥肿的根。有人说，何首乌根是有象人形的，吃了便可 以成仙，我于是常常拔它起来，牵连不断地拔起来，也曾因此弄坏了泥墙，却从来 没有见过有一块根象人样。如果不怕刺，还可以摘到覆盆子，象小珊瑚珠攒成的小 球，又酸又甜，色味都比桑椹要好得远。 　
　　长的草里是不去的，因为相传这园里有一条很大的赤练蛇。
"""
Question: 为什么鲁迅不敢去草里。
```

![image-20240516095406275](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516095406275.png)

示例二：

```
SYSTEM: 使用提供的以三引号分隔的文章来回答问题。如果在文章中找不到答案，请回答“我找不到答案”。
USER: 
"""
　我家的后面有一个很大的园，相传叫作百草园。现在是早已并屋子一起卖给朱 文公的子孙了，连那最末次的相见也已经隔了七八年，其中似乎确凿只有一些野草 ；但那时却是我的乐园。
　　不必说碧绿的菜畦，光滑的石井栏，高大的皂荚树，紫红的桑椹；也不必说鸣 蝉在树叶里长吟，肥胖的黄蜂伏在菜花上，轻捷的叫天子（云雀）忽然从草间直窜 向云霄里去了。单是周围的短短的泥墙根一带，就有无限趣味。油蛉在这里低唱， 蟋蟀们在这里弹琴。翻开断砖来，有时会遇见蜈蚣；还有斑蝥，倘若用手指按住它 的脊梁，便会拍的一声，从后窍喷出一阵烟雾。何首乌藤和木莲藤缠络着，木莲有 莲房一般的果实，何首乌有拥肿的根。有人说，何首乌根是有象人形的，吃了便可 以成仙，我于是常常拔它起来，牵连不断地拔起来，也曾因此弄坏了泥墙，却从来 没有见过有一块根象人样。如果不怕刺，还可以摘到覆盆子，象小珊瑚珠攒成的小 球，又酸又甜，色味都比桑椹要好得远。 　
　　长的草里是不去的，因为相传这园里有一条很大的赤练蛇。
"""
Question: 朱文公的孙子叫什么名字。
```

![image-20240516095523614](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516095523614.png)





鉴于所有模型的上下文窗口都有限，我们需要某种方法来动态查找与所提出问题相关的信息。嵌入可用于实现高效的知识检索。有关如何实现此操作的更多详细信息，请参阅策略“[使用基于嵌入的搜索实现高效的知识检索](https://platform.openai.com/docs/guides/prompt-engineering/tactic-use-embeddings-based-search-to-implement-efficient-knowledge-retrieval)”。

### 策略2：提示模型使用参考内容的引用来回答问题

如果输入已补充了相关知识，则直接要求模型通过引用所提供文档中的段落来在其答案中添加引用。请注意，输出中的引文可以通过所提供文档中的字符串匹配以编程方式进行验证。

```
SYSTEM: 你将获得一份以三引号分隔的文档和一个问题。您的任务是仅使用提供的文档回答问题，并引用用于回答问题的文档的段落。如果文档不包含回答此问题所需的信息，则只需回答：“信息不足”。如果提供了问题的答案，则必须用引文进行注释。使用以下格式引用相关段落 （{“citation”： ...}）。
USER：
"""
　我家的后面有一个很大的园，相传叫作百草园。现在是早已并屋子一起卖给朱 文公的子孙了，连那最末次的相见也已经隔了七八年，其中似乎确凿只有一些野草 ；但那时却是我的乐园。
　　不必说碧绿的菜畦，光滑的石井栏，高大的皂荚树，紫红的桑椹；也不必说鸣 蝉在树叶里长吟，肥胖的黄蜂伏在菜花上，轻捷的叫天子（云雀）忽然从草间直窜 向云霄里去了。单是周围的短短的泥墙根一带，就有无限趣味。油蛉在这里低唱， 蟋蟀们在这里弹琴。翻开断砖来，有时会遇见蜈蚣；还有斑蝥，倘若用手指按住它 的脊梁，便会拍的一声，从后窍喷出一阵烟雾。何首乌藤和木莲藤缠络着，木莲有 莲房一般的果实，何首乌有拥肿的根。有人说，何首乌根是有象人形的，吃了便可 以成仙，我于是常常拔它起来，牵连不断地拔起来，也曾因此弄坏了泥墙，却从来 没有见过有一块根象人样。如果不怕刺，还可以摘到覆盆子，象小珊瑚珠攒成的小 球，又酸又甜，色味都比桑椹要好得远。 　
　　长的草里是不去的，因为相传这园里有一条很大的赤练蛇。
"""
Question: 百草园现在卖给谁了？
```

![image-20240516100847451](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516100847451.png)



## 三、将复杂的任务拆分成更简单的子任务

### 策略1：使用意图识别来标记和用户查询最相关的指令

对于需要大量独立指令来处理不同情况的任务，首先对查询类型进行分类，并使用这种分类来确定所需指令可能是有益的。这可以通过定义固定的类别和硬编码与处理特定类别任务相关的指令来实现。这个过程也可以递归地应用，将任务分解为一系列阶段。这种方法的优点是，每个查询将只包含执行任务下一阶段所需的那些指令，这与使用单个查询执行整个任务相比，可能会导致更低的错误率。

示例1：

```
SYSTEM: 您将收到客户服务查询。请将每个查询分类为主类别和次类别。以json格式提供您的输出，键为：primary和secondary。

主类别：Billing（计费）、Technical Support（技术支持）、Account Management（账户管理）或General Inquiry（一般查询）。

计费次类别：
Unsubscribe or upgrade（取消订阅或升级）
Add a payment method（添加支付方式）
Explanation for charge（费用解释）
Dispute a charge（争议费用）

技术支持次类别：
Troubleshooting（故障排除）
Device compatibility（设备兼容性）
Software updates（软件更新）

账户管理次类别：
Password reset（密码重置）
Update personal information（更新个人信息）
Close account（关闭账户）
Account security（账户安全）

一般查询次类别：
Product information（产品信息）
Pricing（定价）
Feedback（反馈）
Speak to a human（与真人交谈）

User: 我需要让我的互联网再次工作。
```

![image-20240516101545041](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516101545041.png)

根据客户查询的分类，可以向模型提供一组更具体的指令，以便其处理后续步骤。例如，假设客户需要“故障排除”方面的帮助。

```
SYSTEM: 您将获得需要在技术支持上下文中进行故障排除的客户服务查询。通过以下方式帮助用户：

- 要求他们检查与路由器之间的所有电缆是否已连接。请注意，电缆会随着时间的推移而松动。
- 如果所有电缆都已连接，但问题仍然存在，请询问他们使用的路由器型号
- 现在，您将建议他们如何重新启动设备：
-- 如果型号为 MTD-327J，建议他们按下红色按钮并按住 5 秒钟，然后等待 5 分钟再测试连接。
-- 如果型号为 MTD-327S，建议他们拔下并重新插入，然后等待 5 分钟再测试连接。
- 如果客户的问题在重新启动设备并等待 5 分钟后仍然存在，请通过输出 {“IT support requested”} 将他们连接到 IT 支持。
- 如果用户开始提出与此主题无关的问题，请确认他们是否要结束有关故障排除的当前聊天，并根据以下方案对其请求进行分类：

<技术支持/故障排除>

USER: 我需要让我的互联网再次工作。
```

![image-20240516102033966](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240516102033966.png)

### 策略2：对于需要多轮对话的对话程序，请总结和过滤以前的对话

由于模型具有固定的上下文长度，因此用户和助手之间的对话（其中整个对话都包含在上下文窗口中）不能无限期地继续。

这个问题有多种解决方法，其中之一是总结对话中的前几轮。一旦输入的大小达到预定的阈值长度，这可能会触发一个任务，该任务对之前的对话生成摘要，然后将摘要作为System message的一部分。或者在对话的过程中异步的总结之前的对话。

另一种解决方案是动态的选择与当前查询最相关的历史对话。可以使用embedding模型对历史对话进行相似度匹配。

### 策略3：分段总结长文档，并以递归的方式构建完整的摘要

由于模型具有固定的上下文长度，因此它们不能对超过模型最大上下文长度的对长文本做摘要。

解决思路就是先将长文本分成多个部分，对每个部分进行摘要。如果每个部分也超过长度了再继续细分，这个过程可以递归进行。最好汇总整个文档。

这个主要是用来对一本书做摘要，使用场景不大。



## 四、让模型思考

如果要求将 17 乘以 28，您可能不会立即知道，但仍然可以随着时间的推移计算出来。同样，模型在试图立即回答时会犯更多的推理错误，而不是花时间找出答案。在回答之前要求一个“思维链”可以帮助模型更可靠地推理出正确的答案。

### 策略1：指示模型先制定解决方案再得出结果

有时，当我们明确指示模型在得出结论之前从第一性原理进行推理时，我们会得到更好的结果。例如，假设我们想要一个模型来评估学生对数学问题的解决方案。解决这个问题的最明显方法是简单地询问模型学生的解决方案是否正确。

示例1：

```text
SYSTEM: 确定学生的解决方案是否正确。
USER: 问题陈述：我正在建造一个太阳能装置，我需要帮助解决财务问题。
- 土地成本 100 元/平方米
- 我可以以 250 元/平方米的价格购买太阳能电池板
- 我协商了一份维护合同，每年将花费我 10 万元维护，以及额外的 10 元/平方米
第一年运营的总成本与平方米数的函数是多少。

学生的解决方案：设 x 为安装的大小（以平方米为单位）。
1.土地成本：100x
2.太阳能电池板成本：250x
3.维护成本：100,000+100x
总成本：100x + 250x + 100,000 + 100x = 450x + 100,000
```

![image-20240517093829864](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240517093829864.png)

改进版Prompt：

```
SYSTEM: 首先制定你的问题解决方案。然后将您的解决方案与学生的解决方案进行比较，并评估学生的解决方案是否正确。在你自己解决问题之前，不要决定学生的解决方案是否正确。
USER: 问题陈述：我正在建造一个太阳能装置，我需要帮助解决财务问题。
- 土地成本 100 元/平方米
- 我可以以 250 元/平方米的价格购买太阳能电池板
- 我协商了一份维护合同，每年将花费我 10 万元维护，以及额外的 10 元/平方米
第一年运营的总成本与平方米数的函数是多少。

学生的解决方案：设 x 为安装的大小（以平方米为单位）。
1.土地成本：100x
2.太阳能电池板成本：250x
3.维护成本：100,000+100x
总成本：100x + 250x + 100,000 + 100x = 450x + 100,000
```

![image-20240517094022800](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240517094022800.png)



### 策略2：使用内心独白或一系列查询来隐藏模型的推理过程

前面的策略表明，模型在回答特定问题之前详细推理问题有时很重要。

对于某些应用程序，模型用于得出最终答案的推理过程不适合与用户共享。

例如，在辅导应用程序中，我们可能鼓励学生找出自己的答案，但模型对学生解决方案的推理过程可能会向学生揭示答案。

内心独白是一种可以用来缓解这种情况的策略。内心独白的思想是指示模型将输出中对用户隐藏的部分放入结构化格式中，以便于解析它们。然后，在向用户呈现输出之前，将解析输出，并且仅显示部分输出。

示例1：

```
SYSTEM: 按照以下步骤回答用户查询。

第 1 步 - 首先制定自己的问题解决方案。不要依赖学生的解决方案，因为它可能是不正确的。将此步骤的所有工作括在三引号 （"""） 中。

第 2 步 - 将您的解决方案与学生的解决方案进行比较，并评估学生的解决方案是否正确。将此步骤的所有工作括在三引号 （"""） 中。

第 3 步 - 如果学生犯了错误，请确定您可以在不泄露答案的情况下给学生什么提示。将此步骤的所有工作括在三引号 （"""） 中。

第 4 步 - 如果学生犯了错误，请向学生提供上一步的提示（三引号之外）。而不是写“第 4 步 - ......”的提示。

USER：问题陈述：一个盒子里有4个红球和6个蓝球。从盒子里不放回地抽取两个球。抽到的两个球中有一个是红球，另一个是蓝球的概率是多少？
学生解答：(4/10)*(6/9) = 24/90 = 4/15
```

![image-20240517095040666](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240517095040666.png)

示例2：

首先，我们可以要求模型自行解决问题。

```
问题陈述：一个盒子里有4个红球和6个蓝球。从盒子里不放回地抽取两个球。抽到的两个球中有一个是红球，另一个是蓝球的概率是多少？请逐步思考,制定问题的解决方案，然后根据解决方案计算得出最答案。最后将答案给出来。
```

大模型回答结果：

```
解决方案：

首先，我们可以计算抽取两个球中至少有一个是红球、至少有一个是蓝球的情况。这可以通过计算以下两种情况的概率来实现：
1. 第一个球是红球，第二个球是蓝球。
2. 第一个球是蓝球，第二个球是红球。

然后，我们将这两种情况的概率相加，即可得到抽取两个球中有一个是红球、另一个是蓝球的总概率。

1. 第一个球是红球，第二个球是蓝球的情况：
   - 第一个球是红球的概率为：4/10（因为盒子中有4个红球和总共10个球）。
   - 在第一个球是红球的情况下，第二个球是蓝球的概率为：6/9（因为第一个球被抽取走后，剩下9个球中有6个蓝球）。
   - 因此，这种情况的概率为：(4/10) × (6/9)。

2. 第一个球是蓝球，第二个球是红球的情况：
   - 第一个球是蓝球的概率为：6/10（因为盒子中有6个蓝球和总共10个球）。
   - 在第一个球是蓝球的情况下，第二个球是红球的概率为：4/9（因为第一个球被抽取走后，剩下9个球中有4个红球）。
   - 因此，这种情况的概率为：(6/10) × (4/9)。

最后，将这两种情况的概率相加，得到抽取两个球中有一个是红球、另一个是蓝球的总概率。

答案：

\[ P(\text{一个红一个蓝}) = \left(\frac{4}{10} \times \frac{6}{9}\right) + \left(\frac{6}{10} \times \frac{4}{9}\right) \]

\[ = \left(\frac{24}{90}\right) + \left(\frac{24}{90}\right) \]

\[ = \frac{48}{90} \]

\[ = \frac{8}{15} \]

抽取两个球中有一个是红球、另一个是蓝球的概率为 \( \frac{8}{15} \)。
```

接下来，我们可以让模型使用所有可用信息来评估学生解决方案的正确性。

```
SYSTEM: 将您的解决方案与学生的解决方案进行比较，并评估学生的解决方案是否正确。
USER:
问题陈述：
"""
一个盒子里有4个红球和6个蓝球。从盒子里不放回地抽取两个球。抽到的两个球中有一个是红球，另一个是蓝球的概率是多少？请逐步思考,制定问题的解决方案，然后根据解决方案计算得出最答案。最后将答案给出来。
"""

您的解决方案：
"""
解决方案：

首先，我们可以计算抽取两个球中至少有一个是红球、至少有一个是蓝球的情况。这可以通过计算以下两种情况的概率来实现：
1. 第一个球是红球，第二个球是蓝球。
2. 第一个球是蓝球，第二个球是红球。

然后，我们将这两种情况的概率相加，即可得到抽取两个球中有一个是红球、另一个是蓝球的总概率。

1. 第一个球是红球，第二个球是蓝球的情况：
   - 第一个球是红球的概率为：4/10（因为盒子中有4个红球和总共10个球）。
   - 在第一个球是红球的情况下，第二个球是蓝球的概率为：6/9（因为第一个球被抽取走后，剩下9个球中有6个蓝球）。
   - 因此，这种情况的概率为：(4/10) × (6/9)。

2. 第一个球是蓝球，第二个球是红球的情况：
   - 第一个球是蓝球的概率为：6/10（因为盒子中有6个蓝球和总共10个球）。
   - 在第一个球是蓝球的情况下，第二个球是红球的概率为：4/9（因为第一个球被抽取走后，剩下9个球中有4个红球）。
   - 因此，这种情况的概率为：(6/10) × (4/9)。

最后，将这两种情况的概率相加，得到抽取两个球中有一个是红球、另一个是蓝球的总概率。

答案：

\[ P(\text{一个红一个蓝}) = \left(\frac{4}{10} \times \frac{6}{9}\right) + \left(\frac{6}{10} \times \frac{4}{9}\right) \]

\[ = \left(\frac{24}{90}\right) + \left(\frac{24}{90}\right) \]

\[ = \frac{48}{90} \]

\[ = \frac{8}{15} \]

抽取两个球中有一个是红球、另一个是蓝球的概率为 \( \frac{8}{15} \)。
"""

学生的解决方案：
"""
(4/10)*(6/9) = 24/90 = 4/15
"""
```

![image-20240517100046020](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240517100046020.png)



最后，我们可以让模型使用自己的分析来构建一个乐于助人的导师的角色的回复。

```
SYSTEM: 你是一名数学导师。如果学生犯了错误，请以不透露答案的方式向学生提供提示。如果学生没有犯错误，只需给他们一个鼓励性的评论。
USER:
问题陈述：
"""
一个盒子里有4个红球和6个蓝球。从盒子里不放回地抽取两个球。抽到的两个球中有一个是红球，另一个是蓝球的概率是多少？请逐步思考,制定问题的解决方案，然后根据解决方案计算得出最答案。最后将答案给出来。
"""

你的解决方案：
"""
解决方案：

首先，我们可以计算抽取两个球中至少有一个是红球、至少有一个是蓝球的情况。这可以通过计算以下两种情况的概率来实现：
1. 第一个球是红球，第二个球是蓝球。
2. 第一个球是蓝球，第二个球是红球。

然后，我们将这两种情况的概率相加，即可得到抽取两个球中有一个是红球、另一个是蓝球的总概率。

1. 第一个球是红球，第二个球是蓝球的情况：
   - 第一个球是红球的概率为：4/10（因为盒子中有4个红球和总共10个球）。
   - 在第一个球是红球的情况下，第二个球是蓝球的概率为：6/9（因为第一个球被抽取走后，剩下9个球中有6个蓝球）。
   - 因此，这种情况的概率为：(4/10) × (6/9)。

2. 第一个球是蓝球，第二个球是红球的情况：
   - 第一个球是蓝球的概率为：6/10（因为盒子中有6个蓝球和总共10个球）。
   - 在第一个球是蓝球的情况下，第二个球是红球的概率为：4/9（因为第一个球被抽取走后，剩下9个球中有4个红球）。
   - 因此，这种情况的概率为：(6/10) × (4/9)。

最后，将这两种情况的概率相加，得到抽取两个球中有一个是红球、另一个是蓝球的总概率。

答案：

\[ P(\text{一个红一个蓝}) = \left(\frac{4}{10} \times \frac{6}{9}\right) + \left(\frac{6}{10} \times \frac{4}{9}\right) \]

\[ = \left(\frac{24}{90}\right) + \left(\frac{24}{90}\right) \]

\[ = \frac{48}{90} \]

\[ = \frac{8}{15} \]

抽取两个球中有一个是红球、另一个是蓝球的概率为 \( \frac{8}{15} \)。
"""

学生的解决方案：
"""
(4/10)*(6/9) = 24/90 = 4/15
"""

分析：
"""
您的解决方案是正确的，但是学生的解决方案有一个小错误。学生计算了一个红球一个蓝球的概率，但忽略了另一种情况：第一个球是蓝球，第二个球是红球。因此，学生的解决方案应该包括这两种情况的概率相加。正确的概率是 \( \frac{8}{15} \)。
"""
```

![image-20240517100359050](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/image-20240517100359050.png)

GPT3.5 这种策略实测效果不好。

### 策略3：询问模型是否遗漏了内容

## 五、使用外部工具

### 策略1：使用基于Embedding搜索来实现高效的知识检索

text embedding是一种向量，可以测量文本字符串之间的相关性。相似或相关的字符串将比不相关的字符串更接近。由于向量搜索算法的存在，embedding 可用于实现高效的知识检索。特别是，文本语料库可以拆分为块，并且每个块都可以embeding和存储。然后，可以对给定的查询做embedding，并执行向量搜索，以从语料库中找到与查询最相关的文本块。

示例：

其中的`context`是使用向量相似度算法从向量数据库中查询出来的。

```
你是一个乐于助人、尊重和诚实的AI 助手，名叫智能值班，你擅长从已知信息中检索答案给用户，你知识信息的搬运工而不是创造者。
您正在与人类（用户）交谈。您由 xxxx 算法团队训练，与 GPT 或 OpenAI 无关。
基于上下文信息的答案必须使用原始语言，并且禁止修改原始文本。
如果无法从中得到答案，请说“根据已知信息无法回答该问题”，请使用中文作为答案。
请按照 Markdown 格式解析已知信息。
你有如下示例参考：
<example>
<context>
### Wi-Fi连接正常，无法访问内外网
可能原因及解决办法：

可能原因：

1.终端不符合公司信息安全要求，被网络准入系统拦截。

2.终端网络设置错误，未设置为通过DHCP获取IP地址，子网掩码，网关和DNS等必要信息

3.域账号密码错误

解决办法：

1.接入公司内网终端需安装McAfee杀毒软件，ForeScout网络准入等软件，Windows终端需加入公司域。

2.需将终端设置为 DHCP（自动获取IP地址和DNS服务器）

3.域账号密码过期，或已更改密码但未手动重新输入Wi-Fi密码。
</context>
<question>Wi-Fi连接正常，无法访问内外网</question>
<answer>
可能原因及解决办法：

可能原因：

1.终端不符合公司信息安全要求，被网络准入系统拦截。

2.终端网络设置错误，未设置为通过DHCP获取IP地址，子网掩码，网关和DNS等必要信息

3.域账号密码错误

解决办法：

1.接入公司内网终端需安装McAfee杀毒软件，ForeScout网络准入等软件，Windows终端需加入公司域。

2.需将终端设置为 DHCP（自动获取IP地址和DNS服务器）

3.域账号密码过期，或已更改密码但未手动重新输入Wi-Fi密码。
</answer>
</example>

<context>
{context}
</context>
<question>{question}</question>
<answer>:

```



### 策略2：使用代码执行来执行更准确的计算或调用外部API

### 策略3：授予模型对特定函数的访问权限

## 六、系统地测试更改

### 策略1：参考标准答案评估模型输出





##  参考链接

-   [OpenAI prompt engineering guides](https://platform.openai.com/docs/guides/prompt-engineering)

-   [提示词工程指南中文版](https://www.promptingguide.ai/zh)
