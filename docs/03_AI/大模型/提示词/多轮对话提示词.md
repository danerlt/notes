# 多轮对话提示词


流程图如下：
![](https://danerlt-1258802437.cos.ap-chongqing.myqcloud.com/images/slot_multi-turn-flow.png)

## 第一步

结合历史信息识别用户输入的场景和当前场景是否相关，提示词示例如下：


```text
判断当前用户输入内容与当前对话场景的关联性，历史对话记录中的信息仅供参考，有可能跟当前场景无关，如果历史信息中跟当前输入无关的就忽略掉历史信息:

当前对话场景: 订酒店的服务

历史对话记录：
问题: 后天天气怎么样 回答：请问您想查询哪个城市的天气呢？
问题：重庆 回答：重庆2024-6-14号天气为晴天。
问题：预定重庆明晚到后天的酒店  回答：请问您倾向于入住什么档次的酒店？比如豪华、经济等。

当前用户输入: 经济型

这两次输入是否关联（仅用小数回答关联度，得分范围0.0至1.0）

```

## 第二步

### 场景不相关
如果用户输入和当前场景不相关，就全局识别意图，提示词如下：


```text
有下面多种场景，需要你根据用户输入进行判断，只答选项
1. 天气信息查询服务 - 请回复1
2. 订酒店的服务 - 请回复2
3. 公积金咨询 - 请回复3
4. 编制公文通知 - 请回复4
0. 其他场景 - 请回复0
用户输入：后天天气怎么样
请回复序号：
```

### 场景相关

如果用户输入和当前场景相关就提取场景信息，更新slot.

提取slot信息，提示词示例如下：

```text
你是一个信息抽取机器人。
当前问答场景是：【问天气】
当前日期是：2024-06-12

JSON中每个元素代表一个参数信息：
'''
name是参数名称
desc是参数注释，可以做为参数信息的补充
'''

需求：
#01 根据用户输入内容提取有用的信息到value值，严格提取，没有提及就丢弃该元素
#02 返回JSON结果，只需要name和value

返回样例：
/```
JSON：[{'name': 'date', 'desc': '查天气的具体日期。时间格式：yyyy-MM-dd', 'value': ''}]
输入：我想要23年5月1日的天气
答：{'name': 'date', 'value': '2023-05-01'}
/```
```

向用户询问需要补充的slot信息，提示词如下：

```text
你是一个专业的客服。
当前问答场景是：【问天气】

JSON中每个元素代表一个参数信息：
'''
name表示参数名称
desc表示参数的描述，你要根据描述引导用户补充参数value值
'''

需求：
#01 一次最多只向用户问两个参数
#02 回答以"请问"开头

JSON：[{"name": "location", "desc": "查天气的城市或地点", "value": ""}]
向用户提问：
```

重复上面的操作直到所有的slot都提取到了。


## 第三步

当所有的slot都提取到了，调用大模型，外部工具，数据库查询等实现对应场景的功能。



## 参考链接：

- [https://github.com/answerlink/IntelliQ](https://github.com/answerlink/IntelliQ/tree/main)